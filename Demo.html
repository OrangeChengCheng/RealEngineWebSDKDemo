<!doctype html>
<html lang="en-us">

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, height=device-height, user-scalable=0" />
    <title>RealEngineWebSDKDemo</title>
    <link rel="stylesheet" href="https://demo.bjblackhole.com/BlackHole3.0/css/style.css">
</head>

<body>
    <div id="canvas-cntr">
        <canvas id="canvas" style="width:100%; height:100%;" oncontextmenu="event.preventDefault()"
            tabindex="1"></canvas>
        <div class="custom-loading-container">
            <div class="loading-box">
                <div class="icon-box">
                    <img src="https://demo.bjblackhole.com/BlackHole3.0/imgs/loading.gif" />
                </div>
                <div class="common-global-progress-box">
                    <div class="custom-progress-box">
                        <div class="progress-bar">
                            <div class="progress-bar-outer">
                                <div class="progress-bar-inner"></div>
                            </div>
                        </div>
                    </div>
                    <div class="custom-text"></div>
                </div>
                <div class="process-info-box"></div>
            </div>
        </div>
        <div class="btn">
            <button onclick="AddEnclosure()">创建体积矢量</button>
            <button onclick="Cam()">相机聚焦到体积矢量</button>
        </div>
    </div>
    <script async type="text/javascript" src="javascript/RealBIMWeb.js"></script>
    <script async type="text/javascript" src="javascript/BlackHole3D.js"></script>
    <!-- 引擎初始化相关接口 -->
    <script type="text/javascript">
        BlackHole3D = typeof BlackHole3D !== "undefined" ? BlackHole3D : {};
        BlackHole3D["canvas"] = (function () {
            var canvas = document.getElementById('canvas');
            return canvas;
        })();
        window.onresize = function (event) {
            BlackHole3D["m_re_em_window_width"] = BlackHole3D.canvas.clientWidth;
            BlackHole3D["m_re_em_window_height"] = BlackHole3D.canvas.clientHeight;
        }
        window.onbeforeunload = function (event) {
            if (typeof BlackHole3D.releaseEngine != 'undefined') {
                BlackHole3D.releaseEngine();
            }
        };
        window.onload = function (event) {
            if (typeof CreateBlackHoleWebSDK != 'undefined') {
                BlackHole3D = CreateBlackHoleWebSDK(BlackHole3D);
            } else {
                document.addEventListener("RealEngineToBeReady", function () { BlackHole3D = CreateBlackHoleWebSDK(BlackHole3D); });
            }
            document.addEventListener("RESystemReady", RESystemReady);//系统初始化监听
            document.addEventListener("RESystemEngineCreated", RESystemEngineCreated);//场景初始化监听
            document.addEventListener("REDataSetLoadProgress", REDataSetLoadProgress);//模型加载进度监听
            document.addEventListener("REDataSetLoadFinish", REDataSetLoadFinish);//模型加载完成状态
            if ((typeof BlackHole3D["m_re_em_window_width"] != 'undefined') && (typeof BlackHole3D["m_re_em_window_height"] != 'undefined') && (typeof BlackHole3D.RealBIMWeb != 'undefined')) {
                console.log("(typeof m_re_em_window_width != 'undefined') && (typeof m_re_em_window_height != 'undefined')");
                RESystemReady();
            }
        }
        function RESystemReady() {
            var sysInfo = new BlackHole3D.RESysInfo();
            sysInfo.workerjsPath = "https://demo.bjblackhole.com/BlackHole3.0/sdk/RealBIMWeb_Worker.js";
            sysInfo.renderWidth = BlackHole3D.canvas.clientWidth;
            sysInfo.renderHieght = BlackHole3D.canvas.clientHeight;
            sysInfo.commonUrl = "https://demo.bjblackhole.com/default.aspx?dir=url_res02&path=res_gol001";
            sysInfo.userName = "";
            sysInfo.passWord = "";
            BlackHole3D.initEngineSys(sysInfo);
            BlackHole3D.Common.setUseWebCache(true);//是否允许使用浏览器缓存
        }
        //初始化完成后，加载项目
        function RESystemEngineCreated(e) {
            console.log("当前 WebSDK 运行版本", BlackHole3D.getVersion());
            console.log("=========================== 场景初始化完成");
            var isSuccess = e.detail.succeed;
            if (isSuccess) {
                console.log("===========================  场景初始化 --> 成功！！！");
                var dataSetList = [{
                    "dataSetId": "场景",
                    "resourcesAddress": "https://demo.bjblackhole.com/default.aspx?dir=url_res02&path=res_jifang",
                    "useTransInfo": true, "transInfo": [[1, 1, 1], [0, 0, 0, 1], [0.0, 0.0, 0.0]],
                    "dataSetCRS": "", "dataSetCRSNorth": 0.0
                }];
                BlackHole3D.Model.loadDataSet(dataSetList);

                BlackHole3D.Common.setMaxResMemMB(5500);
                BlackHole3D.Common.setExpectMaxInstMemMB(4500);
                BlackHole3D.Common.setExpectMaxInstDrawFaceNum(20000000);
                BlackHole3D.Common.setPageLoadLev(2);
            } else {
                console.log("===========================  场景初始化 --> 失败！！！");
            }
        }
        function REDataSetLoadProgress(e) {
            var progBoxCntr = document.querySelector(".custom-loading-container");
            var progBox = document.querySelector(".progress-bar-inner");
            var progTxt = document.querySelector(".custom-text");
            var progInfo = document.querySelector(".process-info-box");
            var percent = e.detail.progress;
            var processInfo = e.detail.info;
            if (percent < 100) {
                progBox.style.width = `${percent}%`
                progBoxCntr.style.display = "flex";
                progTxt.innerHTML = `${percent}%`
                progInfo.innerHTML = processInfo
            } else {
                progBoxCntr.style.display = "none";
            }
        }
        //模型加载完成状态
        function REDataSetLoadFinish(e) {
            if (e.detail.succeed) {
                //模型加载完成！！！
                document.getElementById('canvas').style.display = "block";
                BlackHole3D.canvas.focus(); //为了解决键盘事件的冲突
            } else {
                //模型加载失败！！！
            }
        }
        //创建围栏
        function AddEnclosure() {
            //体积矢量信息
            var volumeShpInfo = new BlackHole3D.REVolumeShpInfo();
            volumeShpInfo.shpName = "volumeShp001";
            volumeShpInfo.potList = [[14.717769348031592, 57.95791001082713, 4, 3],
            [11.833832403710415, 57.88562541960681, 5, 4],
            [12.011666543451309, 54.24507412739243, 4, 2],
            [14.82709974581475, 54.341189629415496, 4, 2]];
            volumeShpInfo.fenceClr = new BlackHole3D.REColor(255, 255, 255, 128);
            volumeShpInfo.scrASDist = -1.0;
            volumeShpInfo.scrVisDist = 300.0;
            volumeShpInfo.contactSce = true;
            volumeShpInfo.genLine = true;
            volumeShpInfo.lineClr = new BlackHole3D.REColor(255, 0, 0, 128);
            volumeShpInfo.lineWidth = 2;
            var addVolumeShpBool = BlackHole3D.Geometry.addPolyVolumeShp(volumeShpInfo);
            console.log(addVolumeShpBool);
        }
        //相机聚焦到点
        function Cam() {
            var shpName = "volumeShp001";
            var backwardAmp = 1;
            BlackHole3D.Geometry.setCamToShp(shpName, backwardAmp);
        }
    </script>
</body>

</html>