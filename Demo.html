<!doctype html>
<html lang="en-us">

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, height=device-height, user-scalable=0" />
    <title>RealEngineWebSDKDemo</title>
    <link rel="stylesheet" href="https://demo.bjblackhole.com/BlackHole3.0/css/style.css">
</head>

<body>
    <div id="canvas-cntr">
        <canvas id="canvas" style="width:100%; height:100%;" oncontextmenu="event.preventDefault()"
            tabindex="1"></canvas>
        <div class="btn">
            <button onclick="startComment()">开启标注</button>
            <button onclick="endComment()">结束标注</button>
            <button onclick="changeStyle(0)">箭头</button>
            <button onclick="changeStyle(1)">云线框</button>
            <button onclick="changeStyle(2)">矩形</button>
            <button onclick="changeStyle(3)">椭圆</button>
            <button onclick="changeStyle(4)">文字</button>
            <button onclick="changeColor()">黄色</button>
        </div>
    </div>
    <script async type="text/javascript" src="javascript/RealBIMWeb.js"></script>
    <script async type="text/javascript" src="javascript/BlackHole3D.js"></script>
    <!-- <script async type="text/javascript" src="https://demo.bjblackhole.com/BlackHole3.0/sdk/RealBIMWeb.js"></script>
    <script async type="text/javascript" src="https://demo.bjblackhole.com/BlackHole3.0/sdk/BlackHole3D.js"></script> -->
    <!-- 引擎初始化相关接口 -->
    <script type="text/javascript">
        BlackHole3D = typeof BlackHole3D !== "undefined" ? BlackHole3D : {};
        BlackHole3D["canvas"] = (function () {
            var canvas = document.getElementById('canvas');
            return canvas;
        })();
        window.onresize = function (event) {
            BlackHole3D["m_re_em_window_width"] = BlackHole3D.canvas.clientWidth;
            BlackHole3D["m_re_em_window_height"] = BlackHole3D.canvas.clientHeight;
        }
        window.onbeforeunload = function (event) {
            if (typeof BlackHole3D.releaseEngine != 'undefined') {
                BlackHole3D.releaseEngine();
            }
        };
        window.onload = function (event) {
            if (typeof CreateBlackHoleWebSDK != 'undefined') {
                BlackHole3D = CreateBlackHoleWebSDK(BlackHole3D);
            } else {
                document.addEventListener("RealEngineToBeReady", function () { BlackHole3D = CreateBlackHoleWebSDK(BlackHole3D); });
            }
            document.addEventListener("RESystemReady", RESystemReady);//系统初始化监听
            document.addEventListener("RESystemEngineCreated", RESystemEngineCreated);//场景初始化监听
            document.addEventListener("RECADLoadFinish", RECADLoadFinish);
            if ((typeof BlackHole3D["m_re_em_window_width"] != 'undefined') && (typeof BlackHole3D["m_re_em_window_height"] != 'undefined') && (typeof BlackHole3D.RealBIMWeb != 'undefined')) {
                console.log("(typeof m_re_em_window_width != 'undefined') && (typeof m_re_em_window_height != 'undefined')");
                RESystemReady();
            }
        }
        function RESystemReady() {
            var sysInfo = new BlackHole3D.RESysInfo();
            // sysInfo.workerjsPath = "https://demo.bjblackhole.com/BlackHole3.0/sdk/RealBIMWeb_Worker.js";
            sysInfo.workerjsPath = "javascript/RealBIMWeb_Worker.js";
            sysInfo.renderWidth = BlackHole3D.canvas.clientWidth;
            sysInfo.renderHieght = BlackHole3D.canvas.clientHeight;
            sysInfo.commonUrl = "https://demo.bjblackhole.com/default.aspx?dir=url_res02&path=res_gol001";
            sysInfo.userName = "";
            sysInfo.passWord = "";
            BlackHole3D.initEngineSys(sysInfo);
            BlackHole3D.Common.setUseWebCache(true);//是否允许使用浏览器缓存
        }
        //初始化完成后，加载项目
        function RESystemEngineCreated(e) {
            console.log("当前 WebSDK 运行版本", BlackHole3D.getVersion());
            console.log("=========================== 场景初始化完成");
            var isSuccess = e.detail.succeed;
            if (isSuccess) {
                console.log("===========================  场景初始化 --> 成功！！！");
                BlackHole3D.setViewMode(BlackHole3D.REVpTypeEm.None, BlackHole3D.REVpTypeEm.CAD, 0);
                //加载CAD资源
                BlackHole3D.CAD.loadCAD("https://demo.bjblackhole.com/default.aspx?dir=url_res02&path=CAD/1_3019722.dwg", BlackHole3D.RECadUnitEm.CAD_UNIT_Millimeter, 1.0);

                BlackHole3D.Common.setMaxResMemMB(5500);
                BlackHole3D.Common.setExpectMaxInstMemMB(4500);
                BlackHole3D.Common.setExpectMaxInstDrawFaceNum(20000000);
                BlackHole3D.Common.setPageLoadLev(2);
            } else {
                console.log("===========================  场景初始化 --> 失败！！！");
            }
        }
        //CAD加载完成，需要设置图形窗口显示CAD
        function RECADLoadFinish(isSuccess) {
            if (isSuccess) {
                console.log("=========================== 引擎渲染器初始化完成 ");
                document.getElementById('canvas').style.display = "block";
                BlackHole3D.canvas.focus(); //为了解决键盘事件的冲突
                console.log("================ CAD加载成功");
                //设置CAD显示
                BlackHole3D.setViewMode(BlackHole3D.REVpTypeEm.CAD, "", BlackHole3D.REVpRankEm.LR);
            } else {
                console.log("================ CAD加载失败");
            }
        }
        //开启标注
        function startComment() {
            BlackHole3D.CAD.startCommentDraw();//开启标注绘制（初始默认-箭头）
        }
        //结束标注
        function endComment() {
            BlackHole3D.CAD.endCommentDraw();//结束标注绘制
        }
        //切换标注样式
        function changeStyle(style) {
            if (style == 4) {
                let content = prompt("请输入文字", "");
                if (content && content.length) {
                    BlackHole3D.CAD.setDrawingCommentStyle(style);//样式类型 0：箭头 1：云线框 2：矩形 3：椭圆 4：文字
                    BlackHole3D.CAD.setTextCommentText(content);//设置文字标注内容
                }
            } else {
                BlackHole3D.CAD.setDrawingCommentStyle(style);//样式类型 0：箭头 1：云线框 2：矩形 3：椭圆 4：文字
            }
        }
        //设置颜色
        function changeColor() {
            BlackHole3D.CAD.setCommentColor(new BlackHole3D.REColor(255, 255, 0, 255));//设置标注颜色
        }
    </script>
</body>

</html>